# 前端知识点整合笔记
# 第六部分(自动化构建工具)包含以下三个部分
## **6.1 Grunt**
## **6.2 Gulp**
## **6.3 webpack**
---
**目录:**
<!-- TOC -->

- [前端知识点整合笔记](#前端知识点整合笔记)
- [第六部分(自动化构建工具)包含以下三个部分](#第六部分自动化构建工具包含以下三个部分)
    - [**6.1 Grunt**](#61-grunt)
    - [**6.2 Gulp**](#62-gulp)
    - [**6.3 webpack**](#63-webpack)
- [**Grunt**](#grunt)
    - [Grunt介绍](#grunt介绍)
    - [安装并使用grunt](#安装并使用grunt)
    - [Grunrt插件](#grunrt插件)
    - [concat插件(合并JS)](#concat插件合并js)
    - [uglify插件(压缩JS)](#uglify插件压缩js)
    - [jshint插件(JS语法检查)](#jshint插件js语法检查)
    - [cssmin插件(合并压缩CSS)](#cssmin插件合并压缩css)
    - [watch插件(真正实现自动化)](#watch插件真正实现自动化)
- [**Gulp**](#gulp)
    - [Gulp介绍](#gulp介绍)
    - [安装gulp](#安装gulp)
    - [使用Gulp插件](#使用gulp插件)
    - [Gulp重要的API](#gulp重要的api)
    - [处理JS的插件](#处理js的插件)
    - [处理CSS的插件](#处理css的插件)
    - [处理HTML的插件(去空格)](#处理html的插件去空格)
    - [自动编译的插件](#自动编译的插件)
    - [**扩展插件(打包加载gulp插件)**](#扩展插件打包加载gulp插件)
- [**webpack**](#webpack)

<!-- /TOC -->
**深度遍历文件夹。在有文件夹的目录前加上，表示深度遍历，不管嵌套多少层，都能找到**  
`src/js/**/*.js`
# **Grunt**
## Grunt介绍
* Grunt介绍
  * 中文主页 : http://www.gruntjs.net/
  * 是一套前端**自动化构建**工具，一个基于nodeJs的命令行工具
  * 它是一个**任务运行器**, 配合其丰富强大的**插件**
  * 常用功能:
    * **合并文件**(js/css)
    * **压缩文件**(js/css)
    * **语法检查**(js)
    * **less/sass预编译处理** 
    * 其它...
## 安装并使用grunt
* 安装nodejs, 查看版本
  ```
  node -v
  ```
* 创建一个简单的应用grunt_test
  ```
  |- build----------构建生成的文件所在的文件夹
  |- src------------源码文件夹   
      |- js---------------js源文件夹
      |- css--------------css源文件夹
  |- index.html-----页面文件
  |- Gruntfile.js---grunt配置文件(注意首字母大写)
  |- package.json---项目包配置文件
      {
        "name": "grunt_test",
        "version": "1.0.0"   
      }
  ```  
* 全局安装 grunt-cli
  ```
  npm install -g grunt-cli 
  ```
* 安装grunt
  ```
  npm install grunt --save-dev
  
  ```
* 运行构建项目命令
  ```
  grunt  //提示 Warning: Task "default" not found
  ```
* 添加配置文件: Gruntfile.js
  * 此配置文件本质就是一个node函数类型模块
  * 配置编码包含3步:
    1. 初始化插件配置
    2. 加载插件任务
    3. 注册构建任务
  * 基本编码:
    ```
    module.exports = function(grunt){
      // 1. 初始化插件配置
      grunt.initConfig({
          //主要编码处
      });
      // 2. 加载插件任务
      // grunt.loadNpmTasks('grunt-contrib-concat');
      // 3. 注册构建任务
      grunt.registerTask('default', []);
    };
    ```
  * 命令: grunt  //提示done, 但没有任何效果(还没有使用插件定义任务)
## Grunrt插件
* Grunt插件介绍
  * grunt官网的插件列表页面 http://www.gruntjs.net/plugins 
  * 插件分类:
    * grunt团队贡献的插件 : 插件名大都以contrib-开头
    * 第三方提供的插件 : 大都不以contrib-开头
  * 常用的插件:
    * grunt-contrib-clean——清除文件(打包处理生成的)
    * grunt-contrib-concat——合并多个文件的代码到一个文件中
    * grunt-contrib-uglify——压缩j(丑化)s文件
    * grunt-contrib-jshint——javascript语法错误检查；
    * grunt-contrib-cssmin——压缩/合并css文件
    * grunt-contrib-htmlmin——压缩html文件
    * grunt-contrib-imagemin——压缩图片文件(无损)
    * grunt-contrib-copy——复制文件、文件夹
    * grunt-contrib-watch——实时监控文件变化、调用相应的任务重新执行
## concat插件(合并JS)
* 合并js: 使用concat插件
  * 命令:
    ```
    npm install grunt-contrib-concat --save-dev
    ```
  * 编码:
    * src/js/test1.js
      ```
      (function () {
        function add(num1, num2) {
          return num1 + num2;
        }
        console.log(add(10, 20));
      })();
      ```
    * src/js/test2.js
      ```
      (function () {
        var arr = [2,3,4].map(function (item, index) {
          return item+1;
        });
        console.log(arr);
      })();
      ```
  * 配置: Gruntfile.js
    * 配置任务:
       ```
       concat: {
         options: { //可选项配置
           separator: ';'   //使用;连接合并
         },
         build: { //此名称任意
           src:  ["src/js/*.js"],  //合并哪些js文件
           dest: "build/js/built.js" //输出的js文件
         }
       }
       ```
    * 加载插件:
      ```
      grunt.loadNpmTasks('grunt-contrib-concat');
      ```
    * 注册任务:
      ```
      grunt.registerTask('default', ['concat']);
      ```
    * 命令: 
      ```
      grunt  //会在build下生成一个built.js
      ```
## uglify插件(压缩JS)
* 压缩js: 使用uglify插件
  * 下载
    ```
    npm install grunt-contrib-uglify --save-dev
    ```
  * 配置: Gruntfile.js
    * 配置任务:
      ```
      pkg : grunt.file.readJSON('package.json'),
      uglify : {
        options: {  //不是必须的
          banner: '/*! <%= pkg.name %> - v<%= pkg.version %> - ' +
          '<%= grunt.template.today("yyyy-mm-dd") %> */'
        },
        build: {
          files: {
            'build/js/built-<%=pkg.name%>-<%=pkg.version%>.min.js': ['build/js/built.js']
          }
        }
      }
      ```
    * 加载任务:
      ```
      grunt.loadNpmTasks('grunt-contrib-uglify');
      ```
    * 注册任务:
      ```
      grunt.registerTask('default', ['concat', 'uglify']);
      ```
    * 命令: 
      ```
      grunt   //会在build下生成一个压缩的js文件
      ```
    * 注意：
      *  压缩时会把那些定义了但是没用过的东西自动筛除掉
      *  **grunt不支持ES6，需要先使用babel转换成ES5**
      *  **grunt执行任务是同步的**
## jshint插件(JS语法检查)
* js语法检查: 使用jshint插件
  * 命令: 
    ```
    npm install grunt-contrib-jshint --save-dev
    ```
  * 编码: .jshintrc
     ```
     {
       "curly": true,
       "eqeqeq": true,
       "eqnull": true,
       "expr" : true,
       "immed": true,
       "newcap": true,
       "noempty": true,
       "noarg": true,
       "regexp": true,
       "browser": true,
       "devel": true,
       "node": true,
       "boss": false,
       
       //不能使用未定义的变量
       "undef": true,
       //语句后面必须有分号
       "asi": false,
       //预定义不检查的全局变量
       "predef": [ "define", "BMap", "angular", "BMAP_STATUS_SUCCESS"]
     }
     ```
  * 修改src/js/test1.js
    ```
    (function () {
      function add(num1, num2) {
        num1 = num1 + num3
        return num1 + num2;
      }
      console.log(add(10, 20));
    })();
    ```
  * 配置 : Gruntfile.js
    * 配置任务:
      ```
      jshint : {
        options: {
          jshintrc : '.jshintrc' //指定配置文件
        },
        build : ['Gruntfile.js', 'src/js/*.js'] //指定检查的文件
      }
      ```
    * 加载任务:
      ```
      grunt.loadNpmTasks('grunt-contrib-jshint');
      ```
    * 注册任务:
      ```
      grunt.registerTask('default', ['concat', 'uglify', 'jshint']);
      ```
    * 命令: 
      ```
      grunt   //提示变量未定义和语句后未加分号 -->修改后重新编译
      ```
## cssmin插件(合并压缩CSS)
* 使用cssmin插件
  * 安装:
    ```
    npm install grunt-contrib-cssmin --save-dev
    ```
  * 编码: 
    * test1.css
      ```
      #box1 {
        width: 100px;
        height: 100px;
        background: red;
      }
      ```
    * test2.css
      ```
      #box2 {
        width: 200px;
        height: 200px;
        background: blue;
      }
      ```
    * index.html
      ```
      <link rel="stylesheet" href="build/css/output.min.css">
      <div id="box1"></div>
      <div id="box2"></div>
      ```
      
  * 配置 : Gruntfile.js
    * 配置任务:
      ```
      cssmin:{
        options: {
          shorthandCompacting: false,
          roundingPrecision: -1
        },
        build: {
          files: {
              'build/css/output.min.css': ['src/css/*.css']
          }
        }
      }
      ```
    * 加载任务:
      ```
      grunt.loadNpmTasks('grunt-contrib-cssmin');
      ```
    * 注册任务:
      ```
      grunt.registerTask('default', ['concat', 'uglify', 'jshint', 'cssmin']);
      ```
    * 命令: 
      ```
      grunt    //在build/css/下生成output.min.css
      ```
## watch插件(真正实现自动化)
* 使用watch插件（真正实现自动化） 
  * 命令: npm install grunt-contrib-watch --save-dev
  * 配置 : Gruntfile.js
  
    * 配置任务:
      ```
      watch : {
        scripts : {
          files : ['src/js/*.js', 'src/css/*.css'],
          tasks : ['concat', 'jshint', 'uglify', 'cssmin'],
          options : {spawn : false}  
        }
      }
      ```
    * 加载任务:
      ```
      grunt.loadNpmTasks('grunt-contrib-watch');
      ```
    * 注册任务:
      ```
      grunt.registerTask('default', ['concat', 'uglify', 'jshint', 'watch']);
      改进：grunt.registerTask('myWatch', ['default','watch']);
      ```
    * 命令: 
      ```
      grunt   //控制台提示watch已经开始监听, 修改保存后自动编译处理
      ```

---

# **Gulp**
**加了return是异步的，不加return是同步的**  
**在gulp3.X版本中可以添加依赖任务**
```
 //css处理任务, 指定依赖的任务，在开启cssTask这个任务前，会先开启lessTask任务，等lessTask任务结束才会开始cssTask
      gulp.task('cssTask',['lessTask'], function () {
      
        return gulp.src('src/css/*.css')
            .pipe(concat('built.css'))
            .pipe(gulp.dest('dist/css'))
            .pipe(rename({suffix: '.min'}))
            .pipe(cleanCSS({compatibility: 'ie8'}))//兼容ie8
            .pipe(gulp.dest('dist/css'));
      });
```
## Gulp介绍
* Gulp介绍
  * 中文主页: http://www.gulpjs.com.cn/
  * gulp是与grunt功能类似的**前端项目构建**工具, 也是基于Nodejs的自动**任务运行器**
  * 能自动化地完成 javascript/coffee/sass/less/html/image/css 等文件的
    合并、压缩、检查、监听文件变化、浏览器自动刷新、测试等任务
  * gulp更高效(**异步多任务**), 更易于使用, 插件高质量
* 安装 nodejs, 查看版本: node -v
* 创建一个简单的应用gulp_test
  ```
  |- dist
  |- src
    |- js
    |- css
    |- less
  |- index.html
  |- gulpfile.js-----gulp配置文件
  |- package.json
    {
      "name": "gulp_test",
      "version": "1.0.0"
    } 
  ```
## 安装gulp 
* 安装gulp:
  * 全局安装gulp
    ```
    npm install gulp -g
    ```
  * 局部安装gulp
    ```
    npm install gulp --save-dev
    ```
  * 配置编码: gulpfile.js
    ```
    //引入gulp模块
    var gulp = require('gulp');
    //定义默认任务
    gulp.task('任务名', function() {
      // 将你的任务的任务代码放在这
    });
    gulp.task('default', ['任务'])//异步执行
    ```
  * 构建命令: 
    ```
    gulp
    ```
## 使用Gulp插件
* 使用gulp插件
  * 相关插件:
    * gulp-concat : 合并文件(js/css)
    * gulp-uglify : 压缩js文件
    * gulp-rename : 文件重命名
    * gulp-less : 编译less
    * gulp-clean-css : 压缩css
    * gulp-livereload : 实时自动编译刷新
## Gulp重要的API
* **重要API**
* gulp.src(filePath/pathArr) : 
    * 指向指定路径的所有文件, 返回文件流对象
    * 用于读取文件
* gulp.dest(dirPath/pathArr)
    * 指向指定的所有文件夹
    * 用于向文件夹中输出文件
* gulp.task(name, [deps], fn) 
    * 定义一个任务
* gulp.watch() 
    * 监视文件的变化
## 处理JS的插件
* 处理js
* 创建js文件
    * src/js/test1.js
    ```
    (function () {
        function add(num1, num2) {
        var num3 = 0;
        num1 = num2 + num3;
        return num1 + num2;
        }
        console.log(add(10, 30));
    })();
    ```
    * src/js/test2.js
    ```
    (function () {
        var arr = [2,3,4].map(function (item, index) {
            return item+1;
        });
        console.log(arr);
    })();
    ```
* 下载插件:
    ```
    npm install gulp-concat gulp-uglify gulp-rename --save-dev
    ```
* 配置编码
    ```
    var concat = require('gulp-concat');
    var uglify = require('gulp-uglify');
    var rename = require('gulp-rename');
    
    gulp.task('minifyjs', function() {
        return gulp.src('src/js/*.js') //操作的源文件
            .pipe(concat('built.js')) //合并到临时文件     
            .pipe(gulp.dest('dist/js')) //生成到目标文件夹
            .pipe(rename({suffix: '.min'})) //重命名  
            .pipe(uglify())    //压缩
            .pipe(gulp.dest('dist/js'));
    });
    
    gulp.task('default', ['minifyjs']);
    ```
* 页面引入js浏览测试 : index.html
    ```
    <script type="text/javascript" src="dist/js/built.min.js"></script>
    ```
* 打包测试: gulp
## 处理CSS的插件
* 处理css
* 创建less/css文件
    * src/css/test1.css
    ```
    #div1 {
        width: 100px;
        height: 100px;
        background: green;
    }
    ```
    * src/css/test2.css
    ```
    #div2 {
        width: 200px;
        height: 200px;
        background: blue;
    }
    ```
    * src/less/test3.less
    ```
    @base: yellow;
    .index1 { color: @base; }
    .index2 { color: green; }
    ```
* 下载插件:
    ```
    npm install gulp-less gulp-clean-css --save-dev 
    ```
* 配置编码
    ```
    var less = require('gulp-less');
    var cleanCSS = require('gulp-clean-css');
    
    //less处理任务
    gulp.task('lessTask', function () {
    return gulp.src('src/less/*.less')
        .pipe(less()) 
        
        .pipe(gulp.dest('src/css'));
    })
    //css处理任务, 指定依赖的任务
    gulp.task('cssTask',['lessTask'], function () {
    
    return gulp.src('src/css/*.css')
        .pipe(concat('built.css'))
        .pipe(gulp.dest('dist/css'))
        .pipe(rename({suffix: '.min'}))
        .pipe(cleanCSS({compatibility: 'ie8'}))//兼容ie8
        .pipe(gulp.dest('dist/css'));
    });
    
    gulp.task('default', ['minifyjs', 'cssTask']);
    ```
* 页面引入css浏览测试 : index.html
    ```
    <link rel="stylesheet" href="dist/css/built.min.css">
    <div id="div1" class="index1">div1111111</div>
    <div id="div2" class="index2">div2222222</div>
    ```
* 打包测试: gulp
## 处理HTML的插件(去空格)
* 处理html
    * 下载插件:
    ```
    npm install gulp-htmlmin --save-dev
    ```
    * 配置编码
    ```
    var htmlmin = require('gulp-htmlmin');
    //压缩html任务
    gulp.task('htmlMinify', function() {
        return gulp.src('index.html')
            .pipe(htmlmin({collapseWhitespace: true}))
            .pipe(gulp.dest('dist'));
    });
    gulp.task('default', ['minifyjs', 'cssTask', 'htmlMinify']);
    ```
    * 修改页面引入,站在压缩后的文档目录来写
    ```
    <link rel="stylesheet" href="css/built.min.css">
    <script type="text/javascript" src="js/built.min.js"></script>
    ```
    * 打包测试: gulp    
## 自动编译的插件
* 自动编译
* 下载插件
    ```
    npm install gulp-livereload --save-dev
    ```
* 配置编码:
    ```
    var livereload = require('gulp-livereload');
            
    //所有的pipe
    .pipe(livereload());
    
    gulp.task('watch', ['default'], function () {    
    //开启监视
    livereload.listen();
    //监视指定的文件, 并指定对应的处理任务
    gulp.watch('src/js/*.js', ['minifyjs'])
    gulp.watch(['src/css/*.css','src/less/*.less'], ['cssTask','lessTask']);
    });
    ```
    
* 热加载(实时加载)
    * 下载插件：gulp-connect
    ```
    1、 npm install gulp-connect --save-dev
    2、 注册 热加载的任务 server，注意依赖build任务 
    3、注册热加载的任务
        //配置加载的选项
        connect.server({
                root : 'dist/',//提供服务的根路径
                livereload : true,//是否实时刷新
                port : 5000//开启端口号
            });
            // 自动开启链接
            open('http://localhost:5000');//npm install open --save-dev
            // 监视目标文件
        gulp.watch('src/js/*.js', ['js']);
        gulp.watch(['src/css/*.css', 'src/css/*.less'], ['cssMin', 'less']);
    ```
## **扩展插件(打包加载gulp插件)**
* 扩展
    * **打包加载gulp插件**
    * 前提：将插件下载好。
    * 下载打包插件： gulp-load-plugins
    * npm install gulp-load-plugins --save-dev
    * 引入： var $ = require('gulp-load-plugins')();！！！引入的插件是个方法，必须记住调用。
    * 神来之笔：其他的插件不用再引入了
    * 使用方法：
        ```
        * 所有的插件用 $ 引出，其他插件的方法名统一为插件的功能名字(即插件名字的最后一部分)：如：concat,connect,cssmin...
        gulp.task('lib', function() {
            gulp.src('bower_components/**/*.js')
            .pipe(gulp.dest(app.devPath + 'vendor'))
            .pipe(gulp.dest(app.prdPath + 'vendor'))
            .pipe($.connect.reload());
        });

        ```
# **webpack**
